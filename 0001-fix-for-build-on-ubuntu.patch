From 0b7d9c95cfede4110e975fa360d026a0921c4dde Mon Sep 17 00:00:00 2001
From: weizhu <wei1.zhu@intel.com>
Date: Wed, 4 Dec 2019 20:03:33 +0800
Subject: [PATCH 1/2] fix for build on ubuntu

---
 _testsuite/msdk_ts/CMakeLists.txt | 21 +++++++++++++--------
 builder/FindGlobals.cmake         |  2 +-
 2 files changed, 14 insertions(+), 9 deletions(-)
 mode change 100644 => 100755 builder/FindGlobals.cmake

diff --git a/_testsuite/msdk_ts/CMakeLists.txt b/_testsuite/msdk_ts/CMakeLists.txt
index 209e87fbb..ecc2f76dd 100644
--- a/_testsuite/msdk_ts/CMakeLists.txt
+++ b/_testsuite/msdk_ts/CMakeLists.txt
@@ -167,20 +167,12 @@ if ( NOT PERL_RETURN_VALUE )
 endif ( NOT PERL_RETURN_VALUE )
 
 #if ( PERL_INCLUDE_PATH MATCHES .*-NOTFOUND )
-  execute_process ( COMMAND ${PERL_EXECUTABLE}
-                    -MConfig -e "print \$Config{archlibexp}"
-                    OUTPUT_VARIABLE PERL_OUTPUT
-                    RESULT_VARIABLE PERL_RETURN_VALUE )
   if ( NOT PERL_RETURN_VALUE )
     set ( PERL_INCLUDE_PATH ${PERL_OUTPUT}/CORE )
   endif ( NOT PERL_RETURN_VALUE )
 #endif ( PERL_INCLUDE_PATH MATCHES .*-NOTFOUND )
 
 #if ( PERL_LIBRARY MATCHES .*-NOTFOUND )
-  execute_process ( COMMAND ${PERL_EXECUTABLE}
-                    -MConfig -e "print \$Config{libperl}"
-                    OUTPUT_VARIABLE PERL_OUTPUT
-                    RESULT_VARIABLE PERL_RETURN_VALUE )
   if ( NOT PERL_RETURN_VALUE )
     #set ( PERL_LIBRARY /usr/lib/${PERL_OUTPUT} )
     find_file( PERL_LIBRARY ${PERL_OUTPUT}
@@ -188,8 +180,21 @@ endif ( NOT PERL_RETURN_VALUE )
   endif ( NOT PERL_RETURN_VALUE )
 #endif ( PERL_LIBRARY MATCHES .*-NOTFOUND )
 
+if ( PERL_LIBRARY MATCHES NOTFOUND$ )
+  find_package ( PerlLibs )
+endif ( PERL_LIBRARY MATCHES NOTFOUND$ )
+
+get_filename_component( PERL_LIBRARY_PATH ${PERL_LIBRARY} DIRECTORY)
+
+set ( PERL_INCLUDE_PATH ${PERL_LIBRARY_PATH} )
+find_file( PERL_H_FILE perl.h PATHS ${PERL_INCLUDE_PATH} )
+if ( PERL_H_FILE MATCHES NOTFOUND$ )
+  set ( PERL_INCLUDE_PATH ${PERL_LIBRARY_PATH}/perl/${PERL_OUTPUT}/CORE )
+endif()
+
 message ( STATUS "  PERL_VERSION:           " ${PERL_VERSION} )
 message ( STATUS "  PERL_EXECUTABLE:        " ${PERL_EXECUTABLE} )
+message ( STATUS "  PERL_LIBRARY_PATH:      " ${PERL_LIBRARY_PATH} )
 message ( STATUS "  PERL_INCLUDE_PATH:      " ${PERL_INCLUDE_PATH} )
 message ( STATUS "  PERL_LIBRARY:           " ${PERL_LIBRARY} )
 
diff --git a/builder/FindGlobals.cmake b/builder/FindGlobals.cmake
old mode 100644
new mode 100755
index 52feffeaa..bc247bc16
--- a/builder/FindGlobals.cmake
+++ b/builder/FindGlobals.cmake
@@ -90,7 +90,7 @@ if( Linux OR Darwin )
   if (CMAKE_C_COMPILER MATCHES icc)
     set(no_warnings "-Wno-deprecated -Wno-unknown-pragmas -Wno-unused -wd2304")
   else()
-    set(no_warnings "-Wno-deprecated-declarations -Wno-unknown-pragmas -Wno-unused")
+    set(no_warnings "-Wno-deprecated-declarations -Wno-unknown-pragmas -Wno-unused -Wno-memset-elt-size -Wno-class-memaccess -Wno-parentheses -Wno-catch-value -Wno-int-in-bool-context -Wno-format-overflow -Wno-restrict")
   endif()
 
   set(c_warnings "-Wall -Wformat -Wformat-security")
-- 
2.17.1

